<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Kohana-formo : Object-based form handling for Kohana 3" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="javascripts/marked.js"></script>
    <script type="text/javascript" src="javascripts/site.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/bootstrap.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Formo Validation</title>
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

 <div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container">
		  <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="brand" href="./index.html">Formo</a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="">
				<a href="./index.html">Home</a>
			  </li>
			  <li class="">
				<a href="./form-basics.html">Form Basics</a>
			  </li>
			  <li class="active">
				<a href="./validation.html">Validation</a>
			  </li>
			  <li class="">
				<a href="./orm.html">ORM</a>
			  </li>
			  <li class="">
				<a href="./files.html">Files</a>
			  </li>
			  <li class="">
				<a href="./examples.html">Examples</a>
			  </li>
			</ul>
		  </div>
		</div>
	  </div>
	</div>

<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>Validation</h1>
    <p class="lead">Add and remove rules, load values into form and validate, validate raw values against form rules.</p>
  </div>
</header>



  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#rules"><i class="icon-chevron-right"></i> Adding/removing rules</a></li>
          <li><a href="#validation"><i class="icon-chevron-right"></i> Validation</a></li>
          <li><a href="#without-loading"><i class="icon-chevron-right"></i> Validate without loading</a></li>
          <li><a href="#bound"><i class="icon-chevron-right"></i> Bound validation values</a></li>
          <li><a href="#callbacks"><i class="icon-chevron-right"></i> Callbacks</a></li>
        </ul>
      </div>
      <div class="span9">



<section id="rules">
	<div class="page-header">
		<h1>Adding/removing rules</h1>
	</div> <!-- page-header -->

<div class="md">
## Adding rules

To add a rule to a field, use `Formo::add_rule($array)`.

Using this method, you can either:

1. Add a bunch of rules to a bunch of different fields
2. Add a rule to the field

To add a single rule, pass an array containing a Kohana Validation rule definition

```
$form->email
	->add_rule(['not_empty'])
	->add_rule(['email']);
```

To add multiple rules to a single field, your array has to have the key of the field.

```
$form->add_rule([
	'email' => [
		['not_empty'],
		['email'],
	]
]);
```

To add multiple rules to multiple fields, give each set of rules a alias key.

```
$form->add_rule([
	'email' => [
		['not_empty'],
		['email'],
	],
	'password' => [
		['not_empty']
	],
	'confirm' => [
		['matches', [':form_val', 'password', 'confirm']]
	]
]);
```

You can also attach multiple rules using `Formo::add_rule()` on an individual field. To do this, either specify the field's alias as the key or the special token `:self`.

```
$form->email->add_rule([
	':self' => [
		['not_empty'],
		['email'],
	].
]);
```

## Removing rules

Removing rules works much like adding rules. You reference the rule you are removing by exactly matching the rule's first parameter (which is the function call).

Here are some examples of removing rules.

```
$form->email->add_rule(['not_empty']);
$form->email->remove_rule('not_empty');

$form->confirm->add_rule(['matches', [':form_val', 'password', 'confirm']]);
$form->confirm->remove_rule('matches');

$form->add_rule([
	'foo' => [
		[[$obj, 'bar'], [':value', $other, $other2]]
	]
]);

$form->remove_rule([$obj, 'bar']);

$form->add_rule([
	'foo1' => [
		['not_empty']
	],
	'foo2' => [
		['not_empty']
	],
	'foo3' => [
		['not_empty']
	],
]);
$form->remove_rule([
	'foo1' => [
		'not_empty',
	],
	'foo2' => [
		'not_empty',
	],
	'foo3' => [
		'not_empty',
	],
]);
```

## Setting rules directly

You can always set a field's rules directly using `Formo::set()`.

``` 
$form->email->set('rules', [
	['not_empty'],
	['email'],
]);
```

Similarly, you can use this method to clear all rules from a field.

```
$form->email->set('rules', []);
```

## Getting rules

You can get all a field's rules using `Formo::get()`.

```
$rules = $form->email->get('rules');
```
</div> <!-- md -->

</section>


<section id="validation">
	<div class="page-header">
		<h1>Validation</h1>
	</div> <!-- page-header -->

<div class="md">
Usually when you validate a form, you will follow a linear process:

1. Create form
2. Load new values from $_POST data
3. Validate against the form with its new values

You can do this easily using `Formo::load()` and `Formo::validate()`:

```
$form = Formo::form();
// Add stuff to form

if ($form->load($_POST)->validate())
{
	echo ‘You did it!’;
}
```

What this is saying is: “Update all field values from the `$_POST` array, and check if the form validates with those values.”

Formo first checks whether the form appears to be sent at all, and returns `FALSE` if it wasn’t sent.

IF you don’t specify an array in `Formo::load()`, Formo will load values from `Request::$current->post()` by default. Thus, this is the most common syntax for validation:

```
if ($form->load()->validate())
{
	// Passed!
}
```
</div> <!-- md -->

</section>



<section id="without-loading">
	<div class="page-header">
		<h1>Validating without loading values</h1>
	</div> <!-- page-header -->

<div class="md">
Sometimes you may want to check whether a form or field validates without actually loading a new value into the form or field. You can do this by passing an array of `$alias => $value` of field values you want to validate against.

Here’s an example of validating a form without loading any values. The errors returned is an array for a form or group

```
$values = [‘first’ => ‘Billy’, ‘last’ => null, ‘email’ => ‘billy@madison.com’];

// First create a validation object with the values you want to validate against
$validation = $form->validation($values);

// You can do anything with the validation object, it’s just a regular Kohana Validation object
if ( ! $validation->check())
{
	// Passed validation
}
else
{
	// Turn errors into strings
	$errors = $form->validation_errors($validation);
}
```

You can also validate a single field this way. The error returned is a string

```
$validation = $form->email->validation([‘email’ => ‘john@doe.com’]);

if ( ! $error = $form->email->validation_errors($validation))
{

}
```
</div> <!-- md -->

</section>


<section id="bound">
	<div class="page-header">
		<h1>Binding validation values</h1>
	</div> <!-- page-header -->

<div class="md">
The following special parameters and values are bound to a validation object for extensive validation.

<table>
	<thead>
		<tr>
			<th>Parameter</th>
			<th>Value</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>`:value`</td>
			<td>Field's value</td>
		</tr>
		<tr>
			<td>`:formo`</td>
			<td>The formo field object</td>
		</tr>
		<tr>
			<td>`:form_val`</td>
			<td>The parent's value (array)</td>
		</tr>
		<tr>
			<td>`:form`</td>
			<td>The parent formo object</td>
		</tr>
	</tbody>
</table>

## Binding examples

Here's an example of using `in_array` as a rule:  
```
$form->add_rule(['in_array', [':value', [$bar, $bar2, $bar3]]]);
```

Here's a common one. This is uses Kohana's built-in `Valid::matches()` rule:  

```
$form
	->add([
		'alias' => 'password',
		'driver' => 'input|password',
		
	])
	->add([
		'alias' => 'confirm',
		'driver' => 'input|password',
		'rules' => [
			['matches, [':form_val', 'password', 'confirm']]
		]
	]);
```

</div> <!-- md -->
</section>


<section id="callbacks">
	<div class="page-header">
		<h1>Callbacks</h1>
	</div> <!-- page-header -->

<div class="md">
You can attach 'pass' and 'fail' callbacks to fields and forms. Callbacks are anonymous functions that run in the order they are added to the field or form.

The field or form object — whichever object contains the callback — is the single value passed into the callback function.

## Adding pass callbacks

These callbacks run on the field passing

```
$form->email->callback('pass', function($field) {
	// Do something
});

$form->callback([
	'email' => [
		'pass' => [
			function($field) {
				// Do something
			},
			function($field) {
				// Do something else
			}
		]
	]
]);
```

## Adding fail callbacks

These callbacks run on the field failing

```
$form->email->callback('fail', function($field) {
	// Do something
});

$form->callback([
	'email' => [
		'fail' => [
			function($field) {
				// Do something
			},
			function($field) {
				// Do something else
			}
		]
	]
]);
```

## Form-level callbacks

You can also attach callbacks to form or group. These will run under after validation and callbacks run on all their contained fields.

That means, a form or group's 'pass' callbacks only run after every field passes validation and also has run their respective validation. Likewise the form or group's 'fail' callbacks run after all fields finish validating and running their respective callbacks and at least one field failed validation.

Thus, you can have scenarios where individual fields would run their attached 'pass' callbacks, but the parent form or subform would run its 'fail' callbacks.

```
$form->callback([
	':self' => [
		'fail' => function($field) {
		
		}
	],
	'email' => [
		'pass' => function($field) {
		
		}
	],
]);
```

## Setting errors in the callback

Since you have access to the field object, you can set errors to the field

```
$form->email->callback('pass', function($field) {
	if ($foo)
	{
		$field->error($new_error);
	}
});
```
</div> <!-- md -->
</section>


      </div>
    </div>

  </div>


  </body>
</html>
