<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Kohana-formo : Object-based form handling for Kohana 3" />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="javascripts/marked.js"></script>
    <script type="text/javascript" src="javascripts/site.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/bootstrap.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Formo ORM</title>
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

 <div id="navbar" class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container">
		  <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="brand" href="./index.html">
			  <img src="images/formo-logo.png" alt="Formo For Kohana" width="116" height="50">
		  </a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="">
				<a href="./index.html">Home</a>
			  </li>
			  <li class="">
				<a href="./form-basics.html">Form Basics</a>
			  </li>
			  <li class="">
				<a href="./validation.html">Validation</a>
			  </li>
			  <li class="active">
				<a href="./orm.html">ORM</a>
			  </li>
			  <li class="">
				<a href="./files.html">Files</a>
			  </li>
			  <li class="">
				<a href="./examples.html">Examples</a>
			  </li>
			</ul>
		  </div>
		</div>
	  </div>
	</div>

<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>ORM</h1>
    <p class="lead">Auto-generate forms with Formo + Kohana's ORM.</p>
  </div>
</header>



  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#integration"><i class="icon-chevron-right"></i> ORM Integration</a></li>
          <li><a href="#rules"><i class="icon-chevron-right"></i> Sharing model rules and filters</a></li>
          <li><a href="#auto-load"><i class="icon-chevron-right"></i> Auto-loading relationships</a></li>
          <li><a href="#primary-val"><i class="icon-chevron-right"></i> Primary Val and relationships</a></li>
        </ul>
      </div>
      <div class="span9">



        <!-- Download
        ================================================== -->
<section id="integration">
	<div class="page-header">
		<h1>Integrating Formo with Kohana’s ORM</h1>
	</div> <!-- page-header -->

<div class="md">
Formo makes it easy to share model fields, rules and filters with Kohana’s official ORM. You can generate a form directly from your ORM model.

To make a form from your model, use `Formo::orm()`. Here’s an example of making a form from the user model:

```
$user = ORM::factory(‘user’, 10);

$form = Formo::form()
	->orm(‘load’, [‘model’ => $user]);

if ($form->load()->validate())
{
	// Save the user model
	$user
		->values($form->val())
		->save();
}
```

It’s that simple.
</div> <!-- md -->

</section>


<section id="rules">
	<div class="page-header">
		<h1>Sharing model rules and filters</h1>
	</div> <!-- page-header -->

<div class="md">
## Model rules

When you create a form using `Formo::orm(‘load’)`, Formo automatically looks for and applies any rules returned from the `$model->rules()` method. Formo uses Kohana’s built-in validation library for all its validation, so it can use and understand rules inside the model.

That means you don’t have to repeat any of these. Just define ‘em once inside your model.

## Sharing filters with the model

Like rules, when you create a form using `Formo::orm(‘load’)`, Formo also looks for any filters returned from the `$model->filters()` method. Formo will use the filters as they are defined inside your model.

## Sharing filters with the model

Like rules, when you create a form using `Formo::orm(‘load’)`, Formo also looks for any filters returned from the `$model->filters()` method. Formo will use the filters as they are defined inside your model.

## The special `$model::formo()` method.

After `Formo::orm(‘load’)` has added all your fields, rules and filters as defined in your model, Formo will then look for the presence of `$model::formo($form)` inside your model. If the method exists, Formo will run call it.

This gives you a chance to do anything else you may want to do with your form.

Since the entire form object is passed into the method, you can manipulate it however you want.

Here’s an example of using `model::formo()`:

```
$user = ORM::factory('user', 10);
$form->orm('load', ['model' => $user, $opt2, $opt3]);

// From the methods above, when the ORM driver calls formo(), it passes
// any options from 'load' except for the model option as the second parameter
// which means the parameter can be empty or an array of values
// Here it would runs this: $user->formo($form, [$opt2, $opt3])
public function formo($form, $opts)
{
	$form->set([
		'id' => ['render' => FALSE],
		'class_id' => ['label' => 'Class', 'blank' => TRUE],
		'email' => ['driver' => 'input|email',],
		'logins' => ['render' => FALSE],
		'last_login' => ['render' => FALSE],
		'password' => ['render' => FALSE],
	]);
}
```

In this example, we are setting many fields (id, logins, last_login, password) to not render by default. Also, we are defining any special parameters for `class_id` and `email` fields so they render correctly by default.

You can see the sky’s the limit inside your `$model::formo()` method.

If the method is not defined in your model, Formo will not call anything.
</div> <!-- md -->
</section>

<section id="auto-load">
	<div class="page-header">
		<h1>Auto Loading relationships</h1>
	</div> <!-- page-header -->

<div class="md">
### Formo can auto-load relationship fields

To do this, add `'formo' => TRUE` to your relationship definition.

Here's an example of a model's relationship definitions telling formo to auto-load relationships:

```
protected $_belongs_to = array('class' => array('formo' => TRUE));
protected $_has_many = array(
	'foos' => array(
		'model' => 'foo',
		'foreign_key' => 'bar_id',
		'formo' => TRUE,
	),
);
```
</div> <!-- md -->

<section id="primary-val">
	<div class="page-header">
		<h1>Primary Val and relationships</h1>
	</div> <!-- page-header -->

<div class="md">
### Formo needs a primary val from the model

When Formo auto-loads a foreign model, it uses the **primary_val** in to use for the display name in a select field.

By default, Formo looks for a field named `name` in the model for this display name.

### How to define `primary_val` for a model

If your table doesn't use a field name **name** for its primary value, you can set this by definining property `public $_primary_val = 'myField'`;

*Note that the `$_primary_val` property must be **public** since it's not built into Kohana's ORM already, and Formo needs to access it.*

</div> <!-- md -->


	<div style="height:40px"></div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'formo'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>
    </div>

  </div>


  </body>
</html>
